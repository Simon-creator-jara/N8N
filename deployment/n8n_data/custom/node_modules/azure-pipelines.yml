name: $(Build.SourceBranchName).$(date:yyyyMMdd)$(rev:.r)

variables:
  component-name: "n8n_nodes_Lib"
  Artifactory.Repository: "npm-bancolombia/$(component-name)"
  application-code: NU1009002
  project-name: n8n
  lib-name: n8n-nodes-bancolombia-ia

trigger: none

resources:
  - repo: self
    clean: all
    fetchDepth: 1

stages:
  - stage: Build
    displayName: Build and Publish
    jobs:
      - job: Linux
        displayName: Build and publication of artifact
        pool:
          name: Build
          demands:
            - Agent.OS -equals Linux
        steps:
          - template: /n8n_nodes_Lib/pipelines/build.yml
          - ${{ if or(eq(variables['Build.SourceBranch'], 'refs/heads/trunk'), startsWith(variables['Build.SourceBranch'], 'refs/heads/feature/')) }}:
            - template: /n8n_nodes_Lib/pipelines/deploy.yml
